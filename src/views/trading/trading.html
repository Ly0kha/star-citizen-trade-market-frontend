<v-layout align-space-between justify-start column>
	<h1 class="display-1">Trading</h1>
	<v-card>
		<v-form ref="filterForm">
			<v-container>
				<v-layout row wrap>
					<v-flex xs12 md5>
						<v-autocomplete
							v-model="startLocation"
							:items="locations"
							return-object
							:item-text="displayWithLocation"
							label="Start Location"
							prepend-icon="fas fa-plane-departure"
							clearable
						>
						</v-autocomplete>
					</v-flex>
					<v-flex xs12 md5>
						<v-autocomplete
							v-model="endLocation"
							:items="locations"
							return-object
							:item-text="displayWithLocation"
							label="End Location"
							prepend-icon="fas fa-plane-arrival"
							clearable
						></v-autocomplete>
					</v-flex>
					<v-flex md2>
						<v-autocomplete
							v-model="gameVersion"
							:items="gameVersions"
							return-object
							item-text="identifier"
							label="Game Version"
							required
						></v-autocomplete>
					</v-flex>
					<v-flex md5>
						<v-autocomplete
							v-model="selectedCommodities"
							:items="commodities"
							:item-text="displayWithCommodity"
							return-object
							label="Commodities"
							multiple
							chips
							deletable-chips
							clearable
						></v-autocomplete>
					</v-flex>
					<v-flex md7></v-flex>
					<!-- <v-flex xs12 md3>
						<v-text-field type="number" min="1" v-model.number="maxScu" label="Max SCU"></v-text-field>
					</v-flex>
					<v-flex xs12 md3>
						<v-text-field
							type="number"
							min="1"
							v-model.number="startCurrency"
							label="Start aUEC"
						></v-text-field>
					</v-flex> -->
					<v-flex xs12 md12>
						<v-layout row>
							<v-btn color="primary" @click="search({ fetchPolicy: 'network-only' })">Search</v-btn>
							<v-spacer></v-spacer>
							<v-tooltip
								bottom
								:disabled="currentUser && currentUser.hasAnyRole(['USER', 'ADVANCED', 'ADMIN'])"
							>
								<v-btn
									slot="activator"
									@click="reportPricesModal = true"
									color="accent"
									:disabled="currentUser === null || !currentUser.hasAnyRole(['USER', 'ADVANCED', 'ADMIN'])"
									>Report Prices</v-btn
								>
								<template v-if="!currentUser">
									<span>Please log in to use this feature</span>
								</template>
								<template v-else>
									<span>You do not have sufficient rights, contact us on Discord</span>
								</template>
							</v-tooltip>
							<report-price
								:open="reportPricesModal"
								:location="startLocation"
								@close="reportPricesModalClosed()"
							></report-price>
							<v-tooltip bottom :disabled="currentUser && currentUser.hasAnyRole(['ADVANCED', 'ADMIN'])">
								<v-menu
									slot="activator"
									offset-y
									:disabled="currentUser === null || !currentUser.hasAnyRole(['ADVANCED', 'ADMIN'])"
								>
									<v-btn
										slot="activator"
										color="secondary"
										:disabled="currentUser === null || !currentUser.hasAnyRole(['ADVANCED', 'ADMIN'])"
										>Miss Something?</v-btn
									>
									<v-list>
										<v-list-tile @click="createLocationModal = true">
											<v-list-tile-title>Add new Location</v-list-tile-title>
										</v-list-tile>
										<v-list-tile @click="createCommodityModal = true">
											<v-list-tile-title>Add new Commodity</v-list-tile-title>
										</v-list-tile>
										<v-list-tile @click="createGameVersionModal = true">
											<v-list-tile-title>Add new Game Version</v-list-tile-title>
										</v-list-tile>
									</v-list>
								</v-menu>
								<template v-if="!currentUser">
									<span>Please log in to use this feature</span>
								</template>
								<template v-else>
									<span>You do not have sufficient rights, contact us on Discord</span>
								</template>
							</v-tooltip>
							<create-commodity
								:open="createCommodityModal"
								@close="createCommodityModalClosed()"
							></create-commodity>
							<create-game-version
								:open="createGameVersionModal"
								@close="createGameVersionModalClosed()"
							></create-game-version>
							<create-location
								:open="createLocationModal"
								@close="createLocationModalClosed()"
							></create-location>
						</v-layout>
					</v-flex>
				</v-layout>
			</v-container>
		</v-form>
	</v-card>
	<v-data-table
		:headers="headers"
		:items="trades"
		:pagination.sync="pagination"
		no-data-text="You may have set the filter too high or the currently selected version has not yet received price reports"
		class="elevation-1"
	>
		<template slot="items" slot-scope="props">
			<td>{{ displayWithCommodity(props.item.item) }}</td>
			<td>{{ displayWithLocation(props.item.startLocation) }}</td>
			<td>{{ displayWithLocation(props.item.endLocation) }}</td>
			<td class="text-md-right">{{ props.item.buyItemPrice.unitPrice.toFixed(2) }}</td>
			<td class="text-md-right">{{ props.item.sellItemPrice.unitPrice.toFixed(2) }}</td>
			<td class="text-md-right">{{ props.item.profit.toFixed(2) }}</td>
			<td class="text-md-right">{{ props.item.margin.toFixed(2) }} %</td>
			<td>{{ props.item.scanTime | moment('LLL') }}</td>
		</template>
	</v-data-table>
</v-layout>
